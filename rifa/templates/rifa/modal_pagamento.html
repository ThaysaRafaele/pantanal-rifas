<div class="payment-backdrop" id="paymentBackdrop" style="display:none;">
  <div class="payment-modal" role="dialog" aria-modal="true" aria-labelledby="payTitle">
    <button class="pay-close" type="button" aria-label="Fechar" onclick="closePaymentModal()">√ó</button>
    <h3 id="payTitle" class="pay-title">Finalize sua compra</h3>
    <p class="pay-total">Valor total: <span id="payValorTotal">R$ 0,00</span></p>

    <form id="payForm" onsubmit="return verificarCpf(event)">
      <!-- CPF -->
      <div class="mb-3">
        <label class="form-label small text-uppercase">CPF <span class="text-danger">(obrigat√≥rio)</span></label>
        <input type="text" maxlength="14" placeholder="000.000.000-00" class="form-control" id="payCpf" required>
      </div>

      <!-- Dados do usu√°rio -->
      <div id="payUserBox" class="p-3 rounded mb-3" style="display:none;background:#222;border:1px solid #333;">
        <div class="d-flex align-items-center mb-2" style="gap:.6rem;">
          <i class="fas fa-user text-white-50"></i>
          <strong id="payUserNome" class="text-white small" style="font-size:1rem;">‚Äî</strong>
        </div>
        <div class="small text-muted" id="payUserEmail"></div>
        <div class="small text-muted" id="payUserTelefone"></div>
      </div>

      <!-- CPF n√£o encontrado -->
      <div id="payUserNotFound" class="alert alert-warning py-2 mb-3" style="display:none;font-size:.85rem;">
        N√£o existe conta cadastrada neste CPF. 
        <a href="/cadastro/" class="alert-link">Fa√ßa seu cadastro</a> para comprar n√∫meros.
      </div>

      <!-- Bot√£o pagar -->
      <button class="btn btn-success w-100 py-2 mb-2" id="btnPagar" type="button" style="display:none;" onclick="fazerPagamento()">Pagar</button>
      
      <!-- Usar outro cadastro -->
      <button type="button" id="btnOutroCadastro" class="btn btn-link w-100 p-0" style="text-decoration:underline;display:none;" onclick="resetarCpfPagamento()">Usar outro cadastro</button>
    </form>

    <!-- √Årea de QR Code -->
    <div id="modalQrArea" style="display:none;margin-top:16px;text-align:center;">
      <p id="modalQrStatus">Gerando QR Code...</p>
      <div id="modalQrImage" style="display:none;">
        <img id="modalQrImg" src="" alt="QR Code PIX" style="max-width:220px; height:auto; border:1px solid #ddd; background:#fff; padding:8px;" />
        <p style="margin-top:8px;"><a id="modalDownloadQr" href="#" download="qr.png">Baixar QR</a></p>
      </div>
      <pre id="modalQrRaw" style="display:none; word-break:break-all; white-space:pre-wrap; background:#111; color:#0f0; padding:8px; border-radius:6px;"></pre>
    </div>
  </div>
</div>

<script>
  // Simula√ß√£o de CPFs cadastrados
  const usuariosCadastrados = {
    "111.111.111-11": {
      nome: "Jo√£o Silva",
      email: "joao@email.com",
      telefone: "(65) 99999-9999"
    },
    "222.222.222-22": {
      nome: "Maria Souza",
      email: "maria@email.com",
      telefone: "(65) 98888-8888"
    }
  };

  function verificarCpf(event) {
    event.preventDefault();
    const cpf = document.getElementById('payCpf').value.trim();
    const userBox = document.getElementById('payUserBox');
    const notFound = document.getElementById('payUserNotFound');
    const btnPagar = document.getElementById('btnPagar');
    const btnOutro = document.getElementById('btnOutroCadastro');

    // Resetar elementos
    userBox.style.display = 'none';
    notFound.style.display = 'none';
    btnPagar.style.display = 'none';
    btnOutro.style.display = 'none';

    if (usuariosCadastrados.hasOwnProperty(cpf)) {
      // CPF encontrado
      document.getElementById('payUserNome').textContent = usuariosCadastrados[cpf].nome;
      document.getElementById('payUserEmail').textContent = usuariosCadastrados[cpf].email;
      document.getElementById('payUserTelefone').textContent = usuariosCadastrados[cpf].telefone;
      userBox.style.display = 'block';
      btnPagar.style.display = 'block';
      btnOutro.style.display = 'block';
    } else {
      // CPF n√£o encontrado
      notFound.style.display = 'block';
    }
  }

  function fazerPagamento() {
    alert("üîó Integre aqui a API do Mercado Pago para gerar o pagamento PIX.");
    // Aqui voc√™ vai implementar a chamada real para sua API
  }

  function resetarCpfPagamento() {
    document.getElementById('payCpf').value = '';
    document.getElementById('payUserBox').style.display = 'none';
    document.getElementById('btnPagar').style.display = 'none';
    document.getElementById('btnOutroCadastro').style.display = 'none';
    document.getElementById('payUserNotFound').style.display = 'none';
  }
</script>
